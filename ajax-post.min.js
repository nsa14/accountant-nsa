jQuery(window).load((function(){show_account(),checkPushNotification()}));let btn_insert_account=document.getElementById("btn_save1");btn_insert_account.addEventListener("click",(()=>{let t={switch_form:"add_account",txt_account_name:$("#txt_account_name").val(),current_user_phone:(JSON.parse(localStorage.getItem("nsa_register"))||[]).phone};if(0==t.txt_account_name.length)return alert("فیلد ها رو وارد نمایید"),!1;(async()=>{let e=JSON.parse(await postAjax(t));e.status?alertify(e.message,"success"):alertify(e.message,"error",!1)})(),$("#txt_account_name").val("")}));let btn_insert_account_item=document.getElementById("btn_add");btn_insert_account_item.addEventListener("click",(t=>{checkRegister();let e=$("#txt_account_id").val(),a=$("#txt_money").val(),n=t.currentTarget.dataset.type,s=$("#txt_title").val(),i=$("#txt_date").val();if(a.length<=0||e.length<=0)return alertify("فیلد ها رو کامل پر نمایید","error",!1),!1;let r={switch_form:"add_sub_account",txt_account_id:e,txt_money:a,txt_type:n,txt_title:s,txt_date:i};(async()=>{let t=JSON.parse(await postAjax(r));t.status?alertify(t.message,"success"):alertify(t.message,"error",!1)})(),$("#txt_money").val(""),$("#txt_title").val("")}));let btn_insert_account_item_minus=document.getElementById("btn_minus");function show_account(){let t;if(null===localStorage.getItem("nsa_register"))return $("#main_data").html('<div data-target="#exampleNiftyFadeScaleRegister" data-toggle="modal" class="alert alert-danger text-center alert-dismissible" role="alert">\n   لطفا ابتدا ثبت نام نمایید \n </div>'),$("#btn_add_account").css("display","none"),$("#btn_exit").css("display","none"),!1;t=JSON.parse(localStorage.getItem("nsa_register")),$("#btn_register").css("display","none");let e={switch_form:"show_account",current_user_id:t.userid};(async()=>{let t=JSON.parse(await postAjax(e));t.status?parseInt(t.existCount)<=0||t.listItems[0].listSubAccount.length<=0?$("#main_data").html('<div data-target="#exampleNiftyFadeScale" data-toggle="modal" class="alert alert-warning text-center alert-dismissible" role="alert">\n   هنوز حسابی تعریف نکرده اید! \n </div>'):drawListItem(t.listItems):console.log("error ********** "+JSON.stringify(t))})()}function checkRegister(){if((JSON.parse(localStorage.getItem("nsa_register"))||[]).phone.length<=9)return alertify("ابتدا ثبت نام نمایید","error",!1),!1}function showTypeSpan(t){let e=[];return"add"===t?e.push('<span class="label label-table label-success">دریافت</span>'):"minus"===t&&e.push('<span class="label label-table label-danger">پرداخت</span>'),e}function countItem(t){let e=[];return parseInt(t)>=0?e.push('<span class="badge badge-dark"> تعداد '+t+"</span>"):e.push('<span class="badge badge-dark">تعداد: 0</span>'),e}function generate_chart(t,e,a,n,s){c3.generate({bindto:"#exampleC3Donut",data:{columns:[[e,a],[n,s]],type:"donut"},color:{pattern:[$.colors("primary",500),$.colors("red",400)]},legend:{position:"center"},donut:{label:{show:!0},width:50,title:t,onclick:function(t,e){},onmouseover:function(t,e){},onmouseout:function(t,e){}}})}async function showPushNotification(t,e){const a=await navigator.serviceWorker.getRegistration();"showNotification"in a?await a.showNotification(t,{body:e}):new Notification(t,{body:e});JSON.parse(await postAjax({switch_form:"setPushNotificationToRead"}))}function checkPushNotification(){let t={switch_form:"checkPushNotification"};(async()=>{let e=JSON.parse(await postAjax(t));if(e.status)try{await showPushNotification(e.title,e.message)}catch(t){console.error(t)}})()}function calculateFinalMoneyGroupTypes(t,e){return'تراز <span class="text-success">'+t.toLocaleString()+'</span>  <span class="text-danger">'+e.toLocaleString()+"</span>  تومان "}function countMoney(t){let e=[];return parseFloat(t)>=0?e.push('<span class="badge badge-success"> تراز: '+t.toLocaleString()+" تومان  </span> "):e.push('<span class="badge badge-danger"> تراز: '+t.toLocaleString()+" تومان  </span> "),e}function drawListItem(t){let e=[];$(t).each((function(t,a){let n='<div class="col-sm-12 item_account animation-slide-top" data-plugin="appear" data-animate="slide-top" data-sum_add_type="'+a.account_sum_add+'" data-sum_minus_type="'+a.account_sum_minus+'" data-item_name="'+a.listSubAccount.account_name+'" data-item_name_id="'+a.listSubAccount.id+'">      \x3c!-- Widget --\x3e      <div class="widget">        <div class="widget-content padding-20 bg-blue-700 border-radius">          <div class="widget-watermark darker font-size-60 margin-15"><i id="icon-animation" class="icon           wb-clipboard flip-vertical-left"           aria-hidden="true"></i></div>          <div class="counter counter-md counter-inverse text-left">            <div class="counter-number-group">              <span class="counter-number-related text-capitalize">'+a.listSubAccount.account_name+'</span><br>                  </span>                  <span class="counter-number">                '+countMoney(a.account_sum_money)+"                "+countItem(a.account_item_value_count)+"                  </span>                </div>              </div>            </div>          </div>          \x3c!-- End Widget --\x3e        </div>";e.push(n)})),$("#main_data").html(e)}function alertify(t,e,a=!0){swal({title:t,text:"",html:!0,type:e}),a&&setTimeout((function(){location.reload()}),1e3)}async function postAjax(t){let e;return await $.ajax({url:"database.php",method:"POST",data:t,success:function(t){try{e=JSON.parse(t)}catch(t){return $("#main_data").html('<div class="alert alert-danger text-center alert-dismissible" role="alert">\n   خطا! ارتباط اینترنت خود را بررسی نمایید. \n </div>'),console.error(t)}},error:function(t,e,a){alertify("اتصال خود با اینترنت را چک نمایید","warning",!1)}}),JSON.stringify(e)}btn_insert_account_item_minus.addEventListener("click",(t=>{checkRegister();let e=$("#txt_account_id").val(),a=$("#txt_money").val(),n=t.currentTarget.dataset.type,s=$("#txt_title").val(),i=$("#txt_date").val();if(a.length<=0||e.length<=0)return alertify("فیلد ها رو کامل پر نمایید","error",!1),!1;let r={switch_form:"add_sub_account",txt_account_id:e,txt_money:a,txt_type:n,txt_title:s,txt_date:i};(async()=>{let t=JSON.parse(await postAjax(r));t.status?alertify(t.message,"success"):alertify(t.message,"error",!1)})(),$("#txt_money").val(""),$("#txt_title").val("")})),$("#form_register").submit((function(t){t.preventDefault();let e=$(this).serializeArray(),a={};if($(e).each((function(t,e){a[e.name]=e.value})),a.txt_phone.length<=10)return alert("شماره موبایل صحیح را وارد نمایید","error"),!1;(async()=>{let t=JSON.parse(await postAjax(a));if(t.status)if("duplicated"===t.data)alertify(t.message,"warning",!1);else{let e={userid:t.userId,username:a.txt_username,phone:a.txt_phone};localStorage.setItem("nsa_register",JSON.stringify(e)),alertify(t.message,"success")}else alertify(t.message,"error",!1)})()})),$("#form_notification").submit((function(t){t.preventDefault();let e=$(this).serializeArray(),a={};if($(e).each((function(t,e){a[e.name]=e.value})),a.txt_notification_message.length<=5)return alert("متن را وارد نمایید","error"),!1;(async()=>{let t=JSON.parse(await postAjax(a));t.status?alertify(t.message,"success"):alertify(t.message,"error",!1)})()})),$(document).on("click",".btn_login_modal",(function(){let t=$("#txt_phone").val(),e=$("#txt_password").val();if(t.length<=10||e.length<=5)return alertify("شماره موبایل و رمز عبور صحیح را وارد نمایید","error",!1),!1;let a={switch_form:"check_login",current_user_phone:t,current_user_password:e};(async()=>{let t=JSON.parse(await postAjax(a));if(t.status){let e=t.data,a={userid:e.userid,username:e.username,phone:e.phone};localStorage.setItem("nsa_register",JSON.stringify(a)),alertify("خوش آمدید !","success")}else alertify("مشخصات ورود صحیح نمی باشد","error",!1),console.log("error ********** "+JSON.stringify(t.message)),console.log("error **** "+t.message)})()})),$(document).on("click",".item_account",(function(){let t=$(this).data("item_name"),e=$(this).data("sum_add_type")??0,a=$(this).data("sum_minus_type")??0;$("#txt_account_id").val($(this).data("item_name_id")),$("#show_group_name").html('<span class="label label-outline label-default rtl">نام حساب: '+t+"</span>"),$("#show_taraz_group").html(calculateFinalMoneyGroupTypes(e,a)),generate_chart("نمودار دریافت و پرداخت ها","دریافتی ها",Math.abs(e),"پرداختی ها",Math.abs(a)),$(".btn_add_pay").trigger("click")})),$(document).on("click","#show_list_item",(function(){$(".spinner-container").css("display","block");let t=$("#txt_account_id").val();if(t.length<=0)return!1;let e={switch_form:"show_account_sub_items",current_account_id:t};(async()=>{let t=JSON.parse(await postAjax(e));if(t.status){[].push(JSON.stringify(t.message));let e=[];$.each(t.message,(function(a,n){let s="<tr>\n                            <td>"+n.title+"</td>\n                            <td>"+n.money.toLocaleString()+"</td>\n                            <td>"+n.fa_date+"</td>\n                            <td>"+showTypeSpan(n.type)+'</td>\n                            <td><button class="btn btn-pure btn-danger icon wb-trash" id="btn_del_sel" data-account_id="'+t.account_id+'" data-money="'+n.money+'" data-id="'+n.id+'"></button></td>\n                        </tr>';e.push(s)})),$("#showGroupTitle").html(" حساب انتخابی : "+t.account_name),$("#showItem").html(e),$("#exampleNiftyFadeScaleShowListItem").modal({show:"true"})}else console.log("error ********** "+JSON.stringify(t.message)),console.log("error **** "+t.message)})(),$(".spinner-container").css("display","none")})),$(document).on("click",".btn_delete_group",(function(){let t=$("#txt_account_id").val(),e=$("#show_group_name").text();if(!confirm(" آیا از حذف "+e+" و داده های آن اطمینان دارید? "))return!1;{let e={switch_form:"delete_account_with_subs",current_account_id:t};(async()=>{let t=JSON.parse(await postAjax(e));t.status?alertify(t.message,"success"):(console.log("error ********** "+JSON.stringify(t.message)),console.log("error **** "+t.message))})()}})),$(document).on("click","#btn_add_account",(function(){$("#exampleNiftyFadeScale").modal({show:"true"}),$("#xexampleNiftyFadeScale").find("input[name='txt_account_name']").each((function(){$("input[name='txt_account_name']").focus()}))})),$(document).on("click","#btn_del_sel",(function(){let t=$(this).data("account_id"),e=$(this).data("id"),a=$(this).data("money");if(!confirm(" آیا از حذف سطر با مبلغ : "+a+" اطمینان دارید? "))return!1;{let a={switch_form:"delete_subAccount_item",current_account_id:t,current_sub_account_id:e};(async()=>{let t=JSON.parse(await postAjax(a));t.status?alertify(t.message,"success"):(console.log("error ********** "+JSON.stringify(t.message)),console.log("error **** "+t.message))})()}}));